{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  
  "width": 600,
  "height": 400,
  "data": {
    "url": "https://gist.githubusercontent.com/qhoa0005/4ad574867b859458cfe5d9a296b293e0/raw/56c897298f42980f2e76772702d95355b43cf53d/monthly_rainfall_2011_2017.csv"
  },
  "transform": [
    { "filter": "datum.Year == year_select" },
    {
      "lookup": "Month",
      "from": {
        "data": {
          "url": "https://gist.githubusercontent.com/qhoa0005/79bb49b9583be197b341bed9b63eb626/raw/db773bd6dda6b5d6e0bcbfb9bbf8318c9b22529a/total_burnt_2011_2017.csv"
        },
        "key": "month",
        "fields": ["total_burnt"],
        "default": null
      }
    },
    { "filter": "datum.total_burnt != null" },
    {
      "calculate": "['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][datum.Month - 1]",
      "as": "MonthName"
    }
  ],
  "params": [
    {
      "name": "year_select",
      "value": 2017,
      "bind": {
        "input": "range",
        "min": 2011,
        "max": 2017,
        "step": 1,
        "name": "Select year: "
      }
    }
  ],
  "layer": [
    {
      "mark": { "type": "circle", "filled": true, "opacity": 0.8 },
      "encoding": {
        "x": {
          "field": "Rainfall",
          "type": "quantitative",
          "title": "Rainfall (mm)",
          "scale": { "zero": false }
        },
        "y": {
          "field": "total_burnt",
          "type": "quantitative",
          "title": "Burnt area (ha)",
          "scale": { "zero": false }
        },
        "size": {
          "field": "total_burnt",
          "type": "quantitative",
          "title": "Burnt area (ha)",
          "scale": { "range": [50, 1000] }
        },
        "color": {
          "field": "MonthName",
          "type": "nominal",
          "title": "Month",
          "scale": { 
            "domain": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            "scheme": "category20"
          }
        },
        "tooltip": [
          { "field": "Year", "type": "ordinal", "title": "Year" },
          { "field": "MonthName", "type": "nominal", "title": "Month" },
          { "field": "Rainfall", "type": "quantitative", "title": "Rainfall (mm)", "format": ".1f" },
          { "field": "total_burnt", "type": "quantitative", "title": "Burnt area (ha)", "format": ".2f" }
        ]
      }
    },
    {
      "transform": [{ "regression": "total_burnt", "on": "Rainfall" }],
      "mark": { "type": "line", "opacity": 0.7 },
      "encoding": { 
        "x": {
          "field": "Rainfall",
          "type": "quantitative"
        },
        "y": {
          "field": "total_burnt",
          "type": "quantitative"
        },
        "color": { "value": "black" }
      }
    }
  ]
}